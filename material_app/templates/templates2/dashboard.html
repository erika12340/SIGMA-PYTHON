{% extends "templates2/index.html" %}
{% load static %}
{% block content %}

<style>
  .btn-excel {
      background-color: #01492b !important;
      color: white !important;
      border: none !important;
      padding: 6px 12px !important;
      border-radius: 4px !important;
      text-decoration: none !important;
      font-size: 14px !important;
  }
</style>


<div class="content-wrapper text-light">
  <div class="container-xxl flex-grow-1 container-p-y">

    <!-- ==================== Total Data ====================== -->
    <div class="row gy-6">
      <h4 class="mb-4 fw-semibold text-white">Dashboard</h4>

      <!-- Filter Tanggal Total -->
      <div class="col-12 mb-4">
        <div class="card border border-secondary rounded-3 shadow-sm p-3 bg-dark">
          <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
            <label for="production-date" class="form-label mb-0 text-white">Pilih Tanggal Produksi:</label>
            <input type="date" id="production-date" class="form-control w-auto bg-dark text-white border-secondary" onchange="filterByDate(this.value)" value="{{ selected_date|default:'' }}" />
          </div>
        </div>
      </div>

      <!-- Statistik -->
      <div class="col-12">
        <div class="row g-4">
          <div class="col-md-4">
            <div class="card border border-primary rounded-3 shadow"
                 style="background-color: rgba(13, 110, 253, 0.25);">
              <div class="card-body text-center py-4">
                <h6 class="text-white mb-2">Total Consumed</h6>
                <h3 class="mb-0 fw-bold text-white">{{ total_consumed|default:"--" }}</h3>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card border border-success rounded-3 shadow"
                 style="background-color: rgba(25, 135, 84, 0.3);">
              <div class="card-body text-center py-4">
                <h6 class="text-white mb-2">Total Produced</h6>
                <h3 class="mb-0 fw-bold text-white">{{ total_produced|default:"--" }}</h3>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card border border-warning rounded-3 shadow"
                 style="background-color: rgba(255, 193, 7, 0.25);">
              <div class="card-body text-center py-4">
                <h6 class="text-white mb-2">Total Produksi</h6>
                <h3 class="mb-0 fw-bold text-white">{{ total_produksi|default:"--" }}</h3>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== Filter & Tabel Produksi ====================== -->
    <div class="container mt-5">
      <h2 class="text-center mb-4 text-white">Durasi Mesin Produksi</h2>

      <!-- =========== FILTER DATA DURASI MESIN BEKERJA ============= -->
      <div class="card border border-secondary p-3 mb-4"  style="background-color: rgba(0, 88, 203, 0.445);">
        <form method="GET" class="row g-3 align-items-end">

          <!-- FILTER PS_DATE -->
          <div class="col-md-4">
            <label class="form-label text-white mb-1">Tanggal Produksi</label>
            <select name="ps_date" id="ps_date"
                    class="form-control bg-dark text-white border-secondary">
              <option value="">-- Pilih Tanggal --</option>
              {% for tgl in daftar_tanggal %}
                <option value="{{ tgl|date:'Y-m-d' }}" {% if selected_ps_date == tgl|date:'Y-m-d' %}selected{% endif %}>
                  {{ tgl|date:"Y-m-d" }}
                </option>
              {% endfor %}
            </select>
          </div>

          <!-- FILTER SFC CODE -->
          <div class="col-md-4">
            <label class="form-label text-white mb-1">SFC Code</label>
            <select name="sfc_code" id="sfc_code"
                    class="form-control bg-dark text-white border-secondary"
                    onchange="this.form.submit()">
              <option value="">-- Pilih SFC --</option>
              {% for sfc in daftar_sfc %}
                <option value="{{ sfc }}" {% if selected_sfc == sfc %}selected{% endif %}>{{ sfc }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- FILTER MAT SAP CODE -->
          <div class="col-md-4">
            <label class="form-label text-white mb-1">MAT SAP Code</label>
            <select name="mat_sap_code" id="mat_sap_code"
                    class="form-control bg-dark text-white border-secondary"
                    onchange="this.form.submit()">
              <option value="">-- Pilih Material --</option>
              {% for mat in daftar_mat_sap %}
                <option value="{{ mat }}" {% if selected_mat_sap == mat %}selected{% endif %}>{{ mat }}</option>
              {% endfor %}
            </select>
          </div>
        </form>
      </div>
    </div>

      <!--============== TABEL =================-->
      <div class="card border border-primary shadow bg-dark text-white mt-5">
        <div class="card-header bg-primary text-white ">
          <h5 class="mb-0">Data Durasi Produksi per Mesin</h5>
        </div>
        <div class="card-body table-responsive"  style="background-color: rgb(0, 44, 101);">
          <table id="datatable" class="table table-hover table-bordered align-middle mb-0">
            <thead class="table-primary text-dark">
              <tr>
                <th>No</th>
                <th>Ip Materials</th>
                <th>Kode Mesin</th>
                <th>SFC Desc</th>
                <th>Waktu Mulai</th>
                <th>Waktu Selesai</th>
                <th>Durasi</th>
                <th>Shift</th>
              </tr>
            </thead>
            <tbody>
              {% if tabel_data %}
                {% for row in tabel_data %}
                  <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ row.mat_sap_code }}</td>
                    <td>{{ row.mch_code }}</td>
                    <td>{{ row.sfc_desc }}</td>
                    <td>{{ row.ps_start_prod|date:"Y-m-d H:i" }}</td>
                    <td>{{ row.ps_end_prod|date:"Y-m-d H:i" }}</td>
                    <td>{{ row.durasi_jam|floatformat:2 }}</td>
                    <td>{{ row.shf_code }}</td>
                  </tr>
                {% endfor %}
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
 
<!-- JS  -->
  <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
  <!-- DataTables Core + Bootstrap 5 Integration -->
  <script src="https://cdn.datatables.net/2.3.4/js/dataTables.js"></script>
  <script src="https://cdn.datatables.net/2.3.4/js/dataTables.bootstrap5.js"></script>

  <!-- DataTables Buttons Extension -->
  <script src="https://cdn.datatables.net/buttons/3.2.5/js/dataTables.buttons.js"></script>
  <script src="https://cdn.datatables.net/buttons/3.2.5/js/buttons.bootstrap5.js"></script>

  <!-- Export Dependencies -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

  <!-- Buttons Features -->
  <script src="https://cdn.datatables.net/buttons/3.2.5/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/3.2.5/js/buttons.print.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/3.2.5/js/buttons.colVis.min.js"></script>

  <!-- Select2 -->
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>


  <!-- DATA TABLE -->
  <script>
      new DataTable('#datatable', {
          dom: '<"d-flex justify-content-between align-items-center mb-2"lBf>rt<"d-flex justify-content-between align-items-center mt-2"ip>',
          buttons: [
              {
                  extend: 'excelHtml5',
                  className: 'btn-excel' // contoh pake kelas bootstrap
              }
          ],

          lengthMenu: [
              [5, 10, 25, -1],
              [5, 10, 25, "All"]
          ],
      });
  </script>

  <!-- Script Filter Total Produksi -->
  <script>
    function filterByDate(date) {
      const url = new URL(window.location.href);
      url.searchParams.set('date', date);
      window.location.href = url.toString();
    }
  </script>

  <!-- SELECT 2 -->
  <script>
      $('#sfc_code').select2();
      $('#mat_sap_code').select2();
      $('#ps_date').select2();
  </script>
{% endblock %}
